<?php
require_once __DIR__ . '/../vendor/autoload.php';

// Create Laravel app instance
$app = require_once __DIR__ . '/../bootstrap/app.php';
$kernel = $app->make(Illuminate\Contracts\Console\Kernel::class);
$kernel->bootstrap();

use App\Models\Warehouse;

echo "<!DOCTYPE html><html><head><title>ุฅุตูุงุญ ูุดููุฉ 419</title>";
echo "<style>body{font-family:Arial;direction:rtl;} .form{margin:20px 0;padding:20px;border:2px solid #007bff;} .success{color:green;} .error{color:red;} input,button{margin:5px;padding:10px;width:200px;}</style>";
echo "</head><body>";
echo "<h2>ุฅุตูุงุญ ูุดููุฉ 419 - Page Expired</h2>";

if ($_POST) {
    echo "<div class='success'>";
    echo "<h3>โ ุชู ุงุณุชูุจุงู ุงูุจูุงูุงุช ุจูุฌุงุญ!</h3>";
    echo "<p>ูุง ุชูุฌุฏ ูุดููุฉ 419 ูู ูุฐู ุงูุตูุญุฉ</p>";
    echo "<pre>" . print_r($_POST, true) . "</pre>";
    echo "</div>";
}

$warehouses = Warehouse::all();
$warehouse = $warehouses->first();

echo "<h3>๐ ุชุดุฎูุต ุงููุธุงู:</h3>";
echo "<ul>";
echo "<li><strong>Session Driver:</strong> " . config('session.driver') . "</li>";
echo "<li><strong>CSRF Token:</strong> " . csrf_token() . "</li>";
echo "<li><strong>Session ID:</strong> " . session()->getId() . "</li>";
echo "<li><strong>Session Started:</strong> " . (session()->isStarted() ? 'ูุนู โ' : 'ูุง โ') . "</li>";
echo "</ul>";

echo "<h3>๐งช ุงูุงุฎุชุจุงุฑุงุช:</h3>";

// Test 1: No CSRF
echo "<div class='form'>";
echo "<h4>ุงุฎุชุจุงุฑ 1: ุจุฏูู CSRF (ูุถููู ุงูุนูู)</h4>";
echo "<form method='POST' action='/test-no-csrf/warehouses/{$warehouse->id}/products'>";
echo "<p>ุงุณู ุงูููุชุฌ: <input type='text' name='name' value='ููุชุฌ ุจุฏูู CSRF' required></p>";
echo "<p>ูุญุฏุงุช/ูุฑุชููุฉ: <input type='number' name='units_per_carton' value='24' required></p>";
echo "<p>ุงูุญุฏ ุงูุฃุฏูู: <input type='number' name='min_threshold' value='0'></p>";
echo "<p>ุนุฏุฏ ุงููุฑุงุชูู: <input type='number' name='cartons' value='1' required></p>";
echo "<p><button type='submit' style='background:green;color:white;'>ุญูุธ ุจุฏูู CSRF</button></p>";
echo "</form>";
echo "</div>";

// Test 2: With CSRF
echo "<div class='form'>";
echo "<h4>ุงุฎุชุจุงุฑ 2: ูุน CSRF (ูุฏ ูุนุทู 419)</h4>";
echo "<form method='POST' action='/test/warehouses/{$warehouse->id}/products'>";
echo "<input type='hidden' name='_token' value='" . csrf_token() . "'>";
echo "<p>ุงุณู ุงูููุชุฌ: <input type='text' name='name' value='ููุชุฌ ูุน CSRF' required></p>";
echo "<p>ูุญุฏุงุช/ูุฑุชููุฉ: <input type='number' name='units_per_carton' value='24' required></p>";
echo "<p>ุงูุญุฏ ุงูุฃุฏูู: <input type='number' name='min_threshold' value='0'></p>";
echo "<p>ุนุฏุฏ ุงููุฑุงุชูู: <input type='number' name='cartons' value='1' required></p>";
echo "<p><button type='submit' style='background:orange;color:white;'>ุญูุธ ูุน CSRF</button></p>";
echo "</form>";
echo "</div>";

// Test 3: Original form (with middleware)
echo "<div class='form'>";
echo "<h4>ุงุฎุชุจุงุฑ 3: ุงููููุฐุฌ ุงูุฃุตูู (ูุชุทูุจ ุชุณุฌูู ุฏุฎูู + CSRF)</h4>";
echo "<p style='color:red;'><strong>ููุงุญุธุฉ:</strong> ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ูู ุงููุฎุฒู ุฃููุงู!</p>";
echo "<p><a href='/warehouses/{$warehouse->id}/login' target='_blank'>ุชุณุฌูู ุฏุฎูู ูุฎุฒู {$warehouse->name}</a> (ูููุฉ ุงููุฑูุฑ: {$warehouse->password})</p>";
echo "<form method='POST' action='/warehouses/{$warehouse->id}/products'>";
echo "<input type='hidden' name='_token' value='" . csrf_token() . "'>";
echo "<p>ุงุณู ุงูููุชุฌ: <input type='text' name='name' value='ููุชุฌ ุฃุตูู' required></p>";
echo "<p>ูุญุฏุงุช/ูุฑุชููุฉ: <input type='number' name='units_per_carton' value='24' required></p>";
echo "<p>ุงูุญุฏ ุงูุฃุฏูู: <input type='number' name='min_threshold' value='0'></p>";
echo "<p>ุนุฏุฏ ุงููุฑุงุชูู: <input type='number' name='cartons' value='1' required></p>";
echo "<p><button type='submit' style='background:blue;color:white;'>ุญูุธ (ุงููููุฐุฌ ุงูุฃุตูู)</button></p>";
echo "</form>";
echo "</div>";

echo "<h3>๐ ุงูุชุนูููุงุช:</h3>";
echo "<ol>";
echo "<li><strong>ุฌุฑุจ ุงูุงุฎุชุจุงุฑ 1 ุฃููุงู</strong> - ูุฌุจ ุฃู ูุนูู ุจุฏูู ูุดุงูู</li>";
echo "<li><strong>ุฅุฐุง ุนูู ุงูุงุฎุชุจุงุฑ 1</strong>, ุฌุฑุจ ุงูุงุฎุชุจุงุฑ 2</li>";
echo "<li><strong>ููุงุฎุชุจุงุฑ 3</strong>, ุณุฌู ุฏุฎูู ุงููุฎุฒู ุฃููุงู ุซู ุฌุฑุจ</li>";
echo "</ol>";

echo "<p><a href='/test_csrf.php'>ุงุฎุชุจุงุฑ CSRF</a> | <a href='/warehouses'>ุงูุฐูุงุจ ูููุฎุงุฒู</a></p>";
echo "</body></html>";
?>
