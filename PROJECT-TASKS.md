# ğŸ“‹ Project Tasks - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
## Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ø£Ù„Ù Ø¥Ù„Ù‰ Ø§Ù„ÙŠØ§Ø¡

**ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:** 14 Ø£ÙƒØªÙˆØ¨Ø± 2025  
**Project Manager:** The GOAT ğŸ  
**Ø§Ù„Ù…Ù†Ù‡Ø¬ÙŠØ©:** Agile + TDD + Continuous Integration  
**Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:** 12 Ø£Ø³Ø¨ÙˆØ¹ (60 ÙŠÙˆÙ… Ø¹Ù…Ù„)

---

## ğŸ¯ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹

### Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (As-Is)
| Ø§Ù„Ù…ÙƒÙˆÙ† | Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© | Ø§Ù„Ø­Ø§Ù„Ø© | Ø§Ù„ØªÙØ§ØµÙŠÙ„ |
|--------|-----------------|--------|----------|
| **Backend** | **100%** | âœ… Ù…ÙƒØªÙ…Ù„ | 107/107 tests passing |
| **Frontend** | **35%** | â³ Ø¬Ø²Ø¦ÙŠ | React setup + Ø¨Ø¹Ø¶ Ø§Ù„ØµÙØ­Ø§Øª |
| **Integration** | **20%** | â³ Ø¬Ø²Ø¦ÙŠ | API Ù…ÙˆØ¬ÙˆØ¯ Ù„ÙƒÙ† Frontend ØºÙŠØ± Ù…ÙƒØªÙ…Ù„ |
| **Testing** | **Backend: 100%<br>Frontend: 0%** | âš ï¸ | Frontend ÙŠØ­ØªØ§Ø¬ tests |
| **Documentation** | **80%** | â³ | Backend Ù…ÙˆØ«Ù‘Ù‚ØŒ Frontend ÙŠØ­ØªØ§Ø¬ |
| **Deployment** | **0%** | âŒ | Ù„Ù… ÙŠØ¨Ø¯Ø£ |

### Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (To-Be)
- âœ… Backend 100% (Already Done! ğŸ‰)
- âœ… Frontend 100% (Ø§Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ)
- âœ… Integration 100%
- âœ… Testing: Unit + Integration + E2E (100%)
- âœ… Documentation 100%
- âœ… Production Deployment Ø¹Ù„Ù‰ Hostinger

---

## ğŸ“Š Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„ (Work Structure)

```
ÙƒÙ„ Task ÙŠÙ…Ø± Ø¨Ù€ 5 Ù…Ø±Ø§Ø­Ù„:

1ï¸âƒ£ Development (Ø§Ù„ØªØ·ÙˆÙŠØ±)
   â””â”€ ÙƒØªØ§Ø¨Ø© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙØ¹Ù„ÙŠ

2ï¸âƒ£ Unit Testing (Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø©)
   â””â”€ Ø§Ø®ØªØ¨Ø§Ø± ÙƒÙ„ component/function Ù„ÙˆØ­Ø¯Ù‡

3ï¸âƒ£ Integration Testing (Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªÙƒØ§Ù…Ù„)
   â””â”€ Ø§Ø®ØªØ¨Ø§Ø± ØªÙƒØ§Ù…Ù„ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ù…Ø¹ Ø¨Ø¹Ø¶Ù‡Ø§

4ï¸âƒ£ User Testing (Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)
   â””â”€ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…

5ï¸âƒ£ Code Review & Merge (Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ¯Ù…Ø¬)
   â””â”€ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙƒÙˆØ¯ ÙˆØ¯Ù…Ø¬Ù‡ ÙÙŠ main

âœ… Ø¥Ø°Ø§ Ù†Ø¬Ø­Øª ÙƒÙ„ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ â†’ Ù†Ù†ØªÙ‚Ù„ Ù„Ù„Ù€ Task Ø§Ù„ØªØ§Ù„ÙŠ
âŒ Ø¥Ø°Ø§ ÙØ´Ù„Øª Ø£ÙŠ Ù…Ø±Ø­Ù„Ø© â†’ Ù†Ø±Ø¬Ø¹ Ù†ØµÙ„Ø­ ÙˆÙ†Ø¹ÙŠØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
```

---

## ğŸ” Phase 0: Pre-Development Checklist

### âœ… TASK-000: Backend Verification (ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù€ Backend)
**Ø§Ù„Ù…Ø¯Ø©:** ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯ (2 Ø³Ø§Ø¹Ø§Øª)  
**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** ğŸ”´ CRITICAL  
**Ø§Ù„Ø­Ø§Ù„Ø©:** â³ Pending

#### Ø§Ù„Ù‡Ø¯Ù
Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù€ Backend 100% Ø¬Ø§Ù‡Ø² ÙˆÙƒØ§Ù…Ù„ Ø­Ø³Ø¨ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª

#### Checklist

**1. Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Core Systems)**
- [ ] âœ… Products Management (CRUD)
  - [ ] API: GET /api/v1/products
  - [ ] API: POST /api/v1/products
  - [ ] API: PATCH /api/v1/products/{id}
  - [ ] API: DELETE /api/v1/products/{id}
  - [ ] Pack size support (Ø­Ø¬Ù… Ø§Ù„ÙƒØ±ØªÙˆÙ†Ø©)
  - [ ] Min stock per branch

- [ ] âœ… Branches Management
  - [ ] 3 branches seeded (Ø§Ù„Ù…ØµÙ†Ø¹ØŒ Ø§Ù„Ø¹ØªØ¨Ø©ØŒ Ø¥Ù…Ø¨Ø§Ø¨Ø©)
  - [ ] API: GET /api/v1/branches
  - [ ] Branch-scoped data

- [ ] âœ… Users & Roles
  - [ ] 3 roles: manager, accountant, store_user
  - [ ] Permissions configured
  - [ ] API: GET /api/v1/auth/me

**2. Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Inventory)**
- [ ] âœ… Inventory Movements (7/7 tests)
  - [ ] ADD, ISSUE, RETURN, TRANSFER_OUT, TRANSFER_IN
  - [ ] Running balance (product_branch.current_qty)
  - [ ] Ref linking (ref_table, ref_id)

- [ ] âœ… Negative Stock Prevention (7/7 tests)
  - [ ] Validation Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
  - [ ] Transaction safety

**3. Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„ØµØ±Ù ÙˆØ§Ù„Ø¥Ø±Ø¬Ø§Ø¹**
- [ ] âœ… Issue Vouchers (Tests?)
  - [ ] API: GET /api/v1/issue-vouchers
  - [ ] API: POST /api/v1/issue-vouchers
  - [ ] API: POST /api/v1/issue-vouchers/{id}/approve
  - [ ] Line + Header discounts
  - [ ] Sequencing (no gaps)

- [ ] âœ… Return Vouchers (20/20 tests)
  - [ ] API: GET /api/v1/return-vouchers
  - [ ] API: POST /api/v1/return-vouchers
  - [ ] API: POST /api/v1/return-vouchers/{id}/approve
  - [ ] Sequence range: 100001-125000

**4. Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ù…Ø®Ø§Ø²Ù†**
- [ ] âœ… Branch Transfers (16/16 tests)
  - [ ] API: POST /api/v1/transfers
  - [ ] Creates TRANSFER_OUT + TRANSFER_IN
  - [ ] Automatic linking

**5. Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ¯ÙØªØ± Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª**
- [ ] âœ… Customers (16/16 tests)
  - [ ] API: GET /api/v1/customers
  - [ ] API: POST /api/v1/customers
  - [ ] API: GET /api/v1/customers-balances
  - [ ] Auto customer code (CUS-XXXXX)

- [ ] âœ… Customer Ledger
  - [ ] API: GET /api/v1/customers/{id}/statement
  - [ ] API: GET /api/v1/customers/{id}/balance
  - [ ] API: GET /api/v1/customers/{id}/activity
  - [ ] Debit/Credit (Ø¹Ù„ÙŠØ©/Ù„Ù‡)
  - [ ] Running balance

**6. Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª ÙˆØ§Ù„Ø´ÙŠÙƒØ§Øª**
- [ ] âœ… Payments
  - [ ] API: POST /api/v1/payments

- [ ] âœ… Cheques (10/10 tests)
  - [ ] API: GET /api/v1/cheques
  - [ ] API: POST /api/v1/cheques
  - [ ] API: PATCH /api/v1/cheques/{id}/collect
  - [ ] State machine: PENDING â†’ CLEARED/RETURNED

**7. Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±**
- [ ] âœ… Inventory Reports (10/10 tests)
  - [ ] API: GET /api/v1/reports/stock-summary
  - [ ] API: GET /api/v1/reports/product-movements
  - [ ] API: GET /api/v1/reports/low-stock
  - [ ] API: GET /api/v1/reports/stock-by-branch

- [ ] âœ… Customer Reports
  - [ ] API: GET /api/v1/customers-statistics

**8. Ø§Ù„ØªØ±Ù‚ÙŠÙ… ÙˆØ§Ù„ØªØ³Ù„Ø³Ù„**
- [ ] âœ… Sequencing (8/8 tests)
  - [ ] No gaps ÙÙŠ Ø§Ù„ØªØ±Ù‚ÙŠÙ…
  - [ ] Sequence per document type
  - [ ] Transaction safety with FOR UPDATE

**9. Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ§Ù„ØªØµØ¯ÙŠØ±**
- [ ] âœ… PDF Generation
  - [ ] API: GET /api/v1/issue-vouchers/{id}/pdf
  - [ ] API: GET /api/v1/return-vouchers/{id}/pdf
  - [ ] Arabic RTL support

**10. Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„ØªØ¯Ù‚ÙŠÙ‚**
- [ ] âœ… Authentication (JWT)
  - [ ] API: POST /api/v1/auth/login
  - [ ] API: POST /api/v1/auth/logout
  - [ ] API: GET /api/v1/auth/me

- [ ] â³ Activity Log (Optional)
  - [ ] ØªØ³Ø¬ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©

---

#### Testing

**Unit Tests:**
```bash
php artisan test --filter=ProductTest
php artisan test --filter=IssueVoucherTest
php artisan test --filter=ReturnVoucherTest
php artisan test --filter=InventoryMovementTest
php artisan test --filter=CustomerLedgerTest
php artisan test --filter=ChequeTest
php artisan test --filter=SequencerTest
php artisan test --filter=BranchTransferTest

# Expected: ALL PASS âœ…
```

**Integration Tests:**
```bash
php artisan test tests/Integration/

# Expected: 107/107 PASS âœ…
```

#### User Testing

**Manual Test Scenarios:**
1. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
2. Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø°Ù† ØµØ±Ù â†’ Ø§Ø¹ØªÙ…Ø§Ø¯ â†’ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
3. Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø°Ù† Ø¥Ø±Ø¬Ø§Ø¹ â†’ Ø§Ø¹ØªÙ…Ø§Ø¯ â†’ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
4. ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠÙ† ÙØ±ÙˆØ¹ â†’ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†ÙŠÙ†
5. Ø¯ÙØªØ± Ø¹Ù…ÙŠÙ„ â†’ Ù‚ÙŠÙˆØ¯ ØµØ­ÙŠØ­Ø©
6. Ø·Ø¨Ø§Ø¹Ø© PDF

#### Exit Criteria
- âœ… ÙƒÙ„ Ø§Ù„Ù€ APIs ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
- âœ… 107/107 tests passing
- âœ… Manual scenarios ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­
- âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Bugs Ø­Ø±Ø¬Ø©

#### Output
- `BACKEND-VERIFICATION-REPORT.md` - ØªÙ‚Ø±ÙŠØ± ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„Ù†ØªØ§Ø¦Ø¬

---

## ğŸ“¦ Phase 1: Frontend Foundation (Ø§Ù„Ø£Ø³Ø§Ø³Ø§Øª)

### âœ… TASK-101: Project Setup & Configuration
**Ø§Ù„Ù…Ø¯Ø©:** ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯ (6 Ø³Ø§Ø¹Ø§Øª)  
**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** ğŸ”´ CRITICAL  
**Dependencies:** TASK-000  
**Ø§Ù„Ø­Ø§Ù„Ø©:** â³ Pending

#### Ø§Ù„Ù‡Ø¯Ù
Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø´Ø±ÙˆØ¹ React ÙƒØ§Ù…Ù„ Ù…Ø¹ ÙƒÙ„ Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©

#### Development

**1. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:**
```bash
# Ù…Ù† Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù€ project root
npm create vite@latest frontend -- --template react-ts
cd frontend
```

**2. ØªÙ†ØµÙŠØ¨ Dependencies Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:**
```bash
# Core
npm install react@18 react-dom@18
npm install @tanstack/react-query@5
npm install @tanstack/react-router@1
npm install axios
npm install zod
npm install react-hook-form @hookform/resolvers

# UI & Styling
npm install tailwindcss postcss autoprefixer
npm install -D tailwindcss-rtl
npm install @radix-ui/react-dialog
npm install @radix-ui/react-dropdown-menu
npm install @radix-ui/react-select
npm install @radix-ui/react-toast
npm install @radix-ui/react-tooltip
npm install lucide-react

# State & Utils
npm install zustand
npm install date-fns
npm install react-hot-toast

# Dev Dependencies
npm install -D @types/node
npm install -D @types/react
npm install -D @types/react-dom
npm install -D eslint
npm install -D prettier
npm install -D vitest
npm install -D @testing-library/react
npm install -D @testing-library/jest-dom
npm install -D @testing-library/user-event
```

**3. Ø¥Ø¹Ø¯Ø§Ø¯ Tailwind RTL:**
```bash
npx tailwindcss init -p
```

```javascript
// tailwind.config.js
export default {
  content: ['./index.html', './src/**/*.{js,ts,jsx,tsx}'],
  theme: {
    extend: {
      fontFamily: {
        sans: ['Cairo', 'Segoe UI', 'sans-serif'],
      },
    },
  },
  plugins: [
    require('tailwindcss-rtl'),
  ],
};
```

```css
/* src/index.css */
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

* {
  direction: rtl;
}

body {
  font-family: 'Cairo', 'Segoe UI', sans-serif;
}
```

**4. Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª:**
```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ router.tsx
â”‚   â”‚   â”œâ”€â”€ queryClient.ts
â”‚   â”‚   â””â”€â”€ axios.ts
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/          # shadcn/ui primitives
â”‚   â”‚   â”œâ”€â”€ layout/      # Layout components
â”‚   â”‚   â””â”€â”€ shared/      # Reusable components
â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ products/
â”‚   â”‚   â”œâ”€â”€ vouchers/
â”‚   â”‚   â”œâ”€â”€ customers/
â”‚   â”‚   â””â”€â”€ reports/
â”‚   â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ utils/
â”‚   â””â”€â”€ main.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ tailwind.config.js
```

**5. Ø¥Ø¹Ø¯Ø§Ø¯ Axios:**
```typescript
// src/app/axios.ts
import axios from 'axios';

const axiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_URL || 'http://localhost:8000/api/v1',
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
  },
});

// Request interceptor
axiosInstance.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('access_token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// Response interceptor
axiosInstance.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('access_token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default axiosInstance;
```

**6. Ø¥Ø¹Ø¯Ø§Ø¯ React Query:**
```typescript
// src/app/queryClient.ts
import { QueryClient } from '@tanstack/react-query';

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      retry: 1,
      refetchOnWindowFocus: false,
      staleTime: 5 * 60 * 1000, // 5 minutes
    },
  },
});
```

**7. Ø¥Ø¹Ø¯Ø§Ø¯ Environment Variables:**
```bash
# .env
VITE_API_URL=http://localhost:8000/api/v1
```

#### Unit Testing

```bash
# ØªÙ†ØµÙŠØ¨ Vitest
npm install -D vitest @vitest/ui
```

```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: './src/test/setup.ts',
  },
});
```

```typescript
// src/test/setup.ts
import { expect, afterEach } from 'vitest';
import { cleanup } from '@testing-library/react';
import * as matchers from '@testing-library/jest-dom/matchers';

expect.extend(matchers);

afterEach(() => {
  cleanup();
});
```

**Test Case 1: Axios Configuration**
```typescript
// src/app/__tests__/axios.test.ts
import { describe, it, expect } from 'vitest';
import axiosInstance from '../axios';

describe('Axios Instance', () => {
  it('should have correct base URL', () => {
    expect(axiosInstance.defaults.baseURL).toBeDefined();
  });

  it('should have correct headers', () => {
    expect(axiosInstance.defaults.headers['Content-Type']).toBe('application/json');
  });
});
```

**Test Case 2: Query Client**
```typescript
// src/app/__tests__/queryClient.test.ts
import { describe, it, expect } from 'vitest';
import { queryClient } from '../queryClient';

describe('Query Client', () => {
  it('should be defined', () => {
    expect(queryClient).toBeDefined();
  });

  it('should have default options', () => {
    const options = queryClient.getDefaultOptions();
    expect(options.queries?.retry).toBe(1);
    expect(options.queries?.staleTime).toBe(5 * 60 * 1000);
  });
});
```

```bash
# Run tests
npm run test

# Expected: 2/2 PASS âœ…
```

#### Integration Testing

**Test: Full Setup Works**
```typescript
// src/test/integration/setup.test.tsx
import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';
import { QueryClientProvider } from '@tanstack/react-query';
import { queryClient } from '../../app/queryClient';

describe('Project Setup Integration', () => {
  it('should render with QueryClientProvider', () => {
    render(
      <QueryClientProvider client={queryClient}>
        <div>Test App</div>
      </QueryClientProvider>
    );
    
    expect(screen.getByText('Test App')).toBeInTheDocument();
  });
});
```

```bash
# Run integration tests
npm run test -- --run src/test/integration

# Expected: PASS âœ…
```

#### User Testing

**Manual Test:**
1. `npm run dev` â†’ ÙŠØ´ØªØºÙ„ Ø¨Ø¯ÙˆÙ† Ø£Ø®Ø·Ø§Ø¡ âœ…
2. ÙØªØ­ `http://localhost:5173` â†’ ØµÙØ­Ø© ØªØ¸Ù‡Ø± âœ…
3. Console Ø¨Ø¯ÙˆÙ† errors âœ…
4. RTL ÙŠØ´ØªØºÙ„ (Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ†) âœ…

#### Code Review Checklist
- [ ] ÙƒÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
- [ ] Dependencies Ù…Ø«Ø¨ØªØ© Ø¨Ù†Ø¬Ø§Ø­
- [ ] Tailwind RTL ÙŠØ´ØªØºÙ„
- [ ] Axios configured ØµØ­
- [ ] React Query configured ØµØ­
- [ ] Tests ØªØ¹Ø¯ÙŠ
- [ ] Dev server ÙŠØ´ØªØºÙ„

#### Exit Criteria
- âœ… 2/2 unit tests passing
- âœ… 1/1 integration test passing
- âœ… Dev server ÙŠØ´ØªØºÙ„ Ø¨Ø¯ÙˆÙ† errors
- âœ… Tailwind RTL ÙŠØ´ØªØºÙ„

#### Output
- Frontend project Ø¬Ø§Ù‡Ø² âœ…
- `package.json` ÙƒØ§Ù…Ù„
- Folder structure Ù…Ù†Ø¸Ù…

---

### âœ… TASK-102: Design System & UI Components
**Ø§Ù„Ù…Ø¯Ø©:** 2 Ø£ÙŠØ§Ù… (12 Ø³Ø§Ø¹Ø©)  
**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** ğŸ”´ CRITICAL  
**Dependencies:** TASK-101  
**Ø§Ù„Ø­Ø§Ù„Ø©:** â³ Pending

#### Ø§Ù„Ù‡Ø¯Ù
Ø¨Ù†Ø§Ø¡ Ù…ÙƒØªØ¨Ø© Components Ø£Ø³Ø§Ø³ÙŠØ© reusable (15+ component)

#### Development

**Components List:**
1. Button
2. Input
3. Select
4. Dialog (Modal)
5. Toast
6. Card
7. Badge
8. Spinner
9. Skeleton
10. Tooltip
11. DropdownMenu
12. Table (DataTable)
13. FormField
14. DatePicker
15. SearchInput

**Ù…Ø«Ø§Ù„ - Button Component:**
```typescript
// src/components/ui/Button.tsx
import { ButtonHTMLAttributes, forwardRef } from 'react';
import { Loader2 } from 'lucide-react';
import { cn } from '@/lib/utils';

interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'success' | 'danger' | 'ghost';
  size?: 'sm' | 'md' | 'lg';
  loading?: boolean;
}

export const Button = forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant = 'primary', size = 'md', loading, children, disabled, ...props }, ref) => {
    const baseStyles = 'inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none';
    
    const variants = {
      primary: 'bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500',
      secondary: 'bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500',
      success: 'bg-green-600 text-white hover:bg-green-700 focus:ring-green-500',
      danger: 'bg-red-600 text-white hover:bg-red-700 focus:ring-red-500',
      ghost: 'hover:bg-gray-100 focus:ring-gray-500',
    };
    
    const sizes = {
      sm: 'h-8 px-3 text-sm',
      md: 'h-10 px-4',
      lg: 'h-12 px-6 text-lg',
    };
    
    return (
      <button
        ref={ref}
        className={cn(baseStyles, variants[variant], sizes[size], className)}
        disabled={loading || disabled}
        {...props}
      >
        {loading && <Loader2 className="ml-2 h-4 w-4 animate-spin" />}
        {children}
      </button>
    );
  }
);

Button.displayName = 'Button';
```

**Ù…Ø«Ø§Ù„ - Input Component:**
```typescript
// src/components/ui/Input.tsx
import { InputHTMLAttributes, forwardRef } from 'react';
import { cn } from '@/lib/utils';

interface InputProps extends InputHTMLAttributes<HTMLInputElement> {
  error?: string;
}

export const Input = forwardRef<HTMLInputElement, InputProps>(
  ({ className, type, error, ...props }, ref) => {
    return (
      <div className="w-full">
        <input
          type={type}
          className={cn(
            'flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm',
            'placeholder:text-gray-400',
            'focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent',
            'disabled:cursor-not-allowed disabled:opacity-50',
            error && 'border-red-500 focus:ring-red-500',
            className
          )}
          ref={ref}
          {...props}
        />
        {error && (
          <p className="mt-1 text-sm text-red-600">{error}</p>
        )}
      </div>
    );
  }
);

Input.displayName = 'Input';
```

**Ù…Ø«Ø§Ù„ - DataTable Component:**
```typescript
// src/components/shared/DataTable.tsx
import { ReactNode } from 'react';

interface Column<T> {
  key: keyof T | string;
  header: string;
  render?: (item: T) => ReactNode;
  sortable?: boolean;
}

interface DataTableProps<T> {
  data: T[];
  columns: Column<T>[];
  loading?: boolean;
  onRowClick?: (item: T) => void;
}

export function DataTable<T>({ data, columns, loading, onRowClick }: DataTableProps<T>) {
  if (loading) {
    return <div>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>;
  }

  if (data.length === 0) {
    return <div className="text-center py-8 text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</div>;
  }

  return (
    <div className="overflow-x-auto">
      <table className="min-w-full divide-y divide-gray-200">
        <thead className="bg-gray-50">
          <tr>
            {columns.map((column) => (
              <th
                key={String(column.key)}
                className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                {column.header}
              </th>
            ))}
          </tr>
        </thead>
        <tbody className="bg-white divide-y divide-gray-200">
          {data.map((item, index) => (
            <tr
              key={index}
              onClick={() => onRowClick?.(item)}
              className={onRowClick ? 'hover:bg-gray-50 cursor-pointer' : ''}
            >
              {columns.map((column) => (
                <td key={String(column.key)} className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  {column.render ? column.render(item) : String(item[column.key as keyof T])}
                </td>
              ))}
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
```

**Utility - cn() function:**
```typescript
// src/lib/utils.ts
import { clsx, type ClassValue } from 'clsx';
import { twMerge } from 'tailwind-merge';

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
```

#### Unit Testing

**Test Case: Button Component**
```typescript
// src/components/ui/__tests__/Button.test.tsx
import { describe, it, expect, vi } from 'vitest';
import { render, screen, fireEvent } from '@testing-library/react';
import { Button } from '../Button';

describe('Button Component', () => {
  it('should render children', () => {
    render(<Button>Click Me</Button>);
    expect(screen.getByText('Click Me')).toBeInTheDocument();
  });

  it('should handle click events', () => {
    const handleClick = vi.fn();
    render(<Button onClick={handleClick}>Click Me</Button>);
    
    fireEvent.click(screen.getByText('Click Me'));
    expect(handleClick).toHaveBeenCalledOnce();
  });

  it('should show loading state', () => {
    render(<Button loading>Click Me</Button>);
    expect(screen.getByRole('button')).toBeDisabled();
  });

  it('should apply variant styles', () => {
    const { rerender } = render(<Button variant="primary">Primary</Button>);
    expect(screen.getByRole('button')).toHaveClass('bg-blue-600');
    
    rerender(<Button variant="danger">Danger</Button>);
    expect(screen.getByRole('button')).toHaveClass('bg-red-600');
  });
});
```

**Test Case: Input Component**
```typescript
// src/components/ui/__tests__/Input.test.tsx
import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';
import { Input } from '../Input';

describe('Input Component', () => {
  it('should render input field', () => {
    render(<Input placeholder="Enter text" />);
    expect(screen.getByPlaceholderText('Enter text')).toBeInTheDocument();
  });

  it('should display error message', () => {
    render(<Input error="This field is required" />);
    expect(screen.getByText('This field is required')).toBeInTheDocument();
  });

  it('should apply error styles when error exists', () => {
    render(<Input error="Error" />);
    const input = screen.getByRole('textbox');
    expect(input).toHaveClass('border-red-500');
  });
});
```

**Test Case: DataTable Component**
```typescript
// src/components/shared/__tests__/DataTable.test.tsx
import { describe, it, expect, vi } from 'vitest';
import { render, screen, fireEvent } from '@testing-library/react';
import { DataTable } from '../DataTable';

const mockData = [
  { id: 1, name: 'Ù…Ù†ØªØ¬ 1', price: 100 },
  { id: 2, name: 'Ù…Ù†ØªØ¬ 2', price: 200 },
];

const mockColumns = [
  { key: 'id', header: 'Ø§Ù„Ù…Ø¹Ø±Ù' },
  { key: 'name', header: 'Ø§Ù„Ø§Ø³Ù…' },
  { key: 'price', header: 'Ø§Ù„Ø³Ø¹Ø±' },
];

describe('DataTable Component', () => {
  it('should render table with data', () => {
    render(<DataTable data={mockData} columns={mockColumns} />);
    
    expect(screen.getByText('Ù…Ù†ØªØ¬ 1')).toBeInTheDocument();
    expect(screen.getByText('Ù…Ù†ØªØ¬ 2')).toBeInTheDocument();
  });

  it('should display empty state when no data', () => {
    render(<DataTable data={[]} columns={mockColumns} />);
    expect(screen.getByText('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª')).toBeInTheDocument();
  });

  it('should handle row click', () => {
    const handleRowClick = vi.fn();
    render(<DataTable data={mockData} columns={mockColumns} onRowClick={handleRowClick} />);
    
    fireEvent.click(screen.getByText('Ù…Ù†ØªØ¬ 1'));
    expect(handleRowClick).toHaveBeenCalledWith(mockData[0]);
  });

  it('should display loading state', () => {
    render(<DataTable data={[]} columns={mockColumns} loading />);
    expect(screen.getByText('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...')).toBeInTheDocument();
  });
});
```

```bash
# Run all component tests
npm run test -- src/components

# Expected: 10+ tests PASS âœ…
```

#### Integration Testing

**Test: Components Work Together**
```typescript
// src/test/integration/components.test.tsx
import { describe, it, expect, vi } from 'vitest';
import { render, screen, fireEvent } from '@testing-library/react';
import { Button } from '@/components/ui/Button';
import { Input } from '@/components/ui/Input';

describe('Components Integration', () => {
  it('should render form with Button and Input', () => {
    const handleSubmit = vi.fn();
    
    render(
      <form onSubmit={handleSubmit}>
        <Input placeholder="Ø§Ù„Ø§Ø³Ù…" />
        <Button type="submit">Ø­ÙØ¸</Button>
      </form>
    );
    
    expect(screen.getByPlaceholderText('Ø§Ù„Ø§Ø³Ù…')).toBeInTheDocument();
    expect(screen.getByText('Ø­ÙØ¸')).toBeInTheDocument();
  });
});
```

#### User Testing

**Storybook (Optional but Recommended):**
```bash
npm install -D @storybook/react @storybook/react-vite
npx storybook@latest init
```

**Manual Test:**
1. Ø¥Ù†Ø´Ø§Ø¡ ØµÙØ­Ø© test ÙÙŠ `/src/pages/ComponentsTest.tsx`
2. Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ù€ components
3. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù†:
   - âœ… Button Ø¨ÙƒÙ„ Ø§Ù„Ù€ variants
   - âœ… Input Ø¹Ø§Ø¯ÙŠ + Ù…Ø¹ error
   - âœ… DataTable Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª + ÙØ§Ø¶ÙŠ
   - âœ… Loading states
   - âœ… RTL ÙŠØ´ØªØºÙ„ ØµØ­

#### Code Review Checklist
- [ ] 15 components Ù…ÙˆØ¬ÙˆØ¯Ø©
- [ ] ÙƒÙ„ component Ù„Ù‡ test
- [ ] TypeScript types ØµØ­ÙŠØ­Ø©
- [ ] Tailwind classes ØµØ­ÙŠØ­Ø©
- [ ] RTL ÙŠØ´ØªØºÙ„
- [ ] Accessible (a11y)

#### Exit Criteria
- âœ… 15+ components Ø¬Ø§Ù‡Ø²Ø©
- âœ… 10+ unit tests passing
- âœ… Integration tests passing
- âœ… Components ØªØ´ØªØºÙ„ Ø¨Ø¯ÙˆÙ† bugs
- âœ… Storybook Ø¬Ø§Ù‡Ø² (optional)

#### Output
- 15+ reusable components âœ…
- Test coverage > 80%
- Component library Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…

---

### âœ… TASK-103: Authentication System
**Ø§Ù„Ù…Ø¯Ø©:** 2 Ø£ÙŠØ§Ù… (12 Ø³Ø§Ø¹Ø©)  
**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** ğŸ”´ CRITICAL  
**Dependencies:** TASK-102  
**Ø§Ù„Ø­Ø§Ù„Ø©:** â³ Pending

#### Ø§Ù„Ù‡Ø¯Ù
Ø¨Ù†Ø§Ø¡ Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙƒØ§Ù…Ù„ Ù…Ø¹ JWT + Protected Routes

#### Development

**1. Auth Context:**
```typescript
// src/features/auth/AuthContext.tsx
import { createContext, useContext, useState, useEffect, ReactNode } from 'react';
import axios from '@/app/axios';
import { User } from '@/types';

interface AuthContextType {
  user: User | null;
  isAuthenticated: boolean;
  isLoading: boolean;
  login: (email: string, password: string) => Promise<void>;
  logout: () => void;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    // Check if user is logged in
    const token = localStorage.getItem('access_token');
    if (token) {
      fetchUser();
    } else {
      setIsLoading(false);
    }
  }, []);

  const fetchUser = async () => {
    try {
      const { data } = await axios.get('/auth/me');
      setUser(data.data);
    } catch (error) {
      localStorage.removeItem('access_token');
    } finally {
      setIsLoading(false);
    }
  };

  const login = async (email: string, password: string) => {
    const { data } = await axios.post('/auth/login', { email, password });
    localStorage.setItem('access_token', data.access_token);
    setUser(data.user);
  };

  const logout = () => {
    localStorage.removeItem('access_token');
    setUser(null);
    window.location.href = '/login';
  };

  return (
    <AuthContext.Provider value={{ user, isAuthenticated: !!user, isLoading, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
}

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) throw new Error('useAuth must be used within AuthProvider');
  return context;
};
```

**2. Login Page:**
```typescript
// src/features/auth/LoginPage.tsx
import { useState } from 'react';
import { useAuth } from './AuthContext';
import { Button } from '@/components/ui/Button';
import { Input } from '@/components/ui/Input';
import { Card } from '@/components/ui/Card';
import toast from 'react-hot-toast';

export function LoginPage() {
  const { login } = useAuth();
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      await login(email, password);
      toast.success('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
    } catch (error: any) {
      toast.error(error.response?.data?.message || 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      <Card className="w-full max-w-md p-8">
        <h1 className="text-2xl font-bold text-center mb-6">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h1>
        
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium mb-1">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <Input
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              placeholder="example@email.com"
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-1">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <Input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
              required
            />
          </div>

          <Button type="submit" className="w-full" loading={loading}>
            Ø¯Ø®ÙˆÙ„
          </Button>
        </form>
      </Card>
    </div>
  );
}
```

**3. Protected Route:**
```typescript
// src/components/ProtectedRoute.tsx
import { Navigate } from '@tanstack/react-router';
import { useAuth } from '@/features/auth/AuthContext';
import { ReactNode } from 'react';

interface ProtectedRouteProps {
  children: ReactNode;
  requiredPermission?: string;
}

export function ProtectedRoute({ children, requiredPermission }: ProtectedRouteProps) {
  const { isAuthenticated, isLoading, user } = useAuth();

  if (isLoading) {
    return <div>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>;
  }

  if (!isAuthenticated) {
    return <Navigate to="/login" />;
  }

  if (requiredPermission && !user?.permissions.includes(requiredPermission)) {
    return <div>Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©</div>;
  }

  return <>{children}</>;
}
```

**4. Types:**
```typescript
// src/types/index.ts
export interface User {
  id: number;
  name: string;
  email: string;
  role: 'manager' | 'accountant' | 'store_user';
  branch_id?: number;
  branch?: Branch;
  permissions: string[];
}

export interface Branch {
  id: number;
  code: string;
  name: string;
}
```

#### Unit Testing

```typescript
// src/features/auth/__tests__/AuthContext.test.tsx
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { renderHook, act, waitFor } from '@testing-library/react';
import { AuthProvider, useAuth } from '../AuthContext';
import axios from '@/app/axios';

vi.mock('@/app/axios');

describe('AuthContext', () => {
  beforeEach(() => {
    localStorage.clear();
    vi.clearAllMocks();
  });

  it('should provide auth context', () => {
    const wrapper = ({ children }: any) => <AuthProvider>{children}</AuthProvider>;
    const { result } = renderHook(() => useAuth(), { wrapper });

    expect(result.current).toBeDefined();
    expect(result.current.isAuthenticated).toBe(false);
  });

  it('should login successfully', async () => {
    const mockUser = { id: 1, name: 'Test User', email: 'test@test.com' };
    vi.mocked(axios.post).mockResolvedValue({
      data: { access_token: 'fake-token', user: mockUser },
    });

    const wrapper = ({ children }: any) => <AuthProvider>{children}</AuthProvider>;
    const { result } = renderHook(() => useAuth(), { wrapper });

    await act(async () => {
      await result.current.login('test@test.com', 'password');
    });

    expect(result.current.isAuthenticated).toBe(true);
    expect(result.current.user).toEqual(mockUser);
    expect(localStorage.getItem('access_token')).toBe('fake-token');
  });

  it('should logout successfully', async () => {
    localStorage.setItem('access_token', 'fake-token');
    
    const wrapper = ({ children }: any) => <AuthProvider>{children}</AuthProvider>;
    const { result } = renderHook(() => useAuth(), { wrapper });

    act(() => {
      result.current.logout();
    });

    expect(result.current.isAuthenticated).toBe(false);
    expect(localStorage.getItem('access_token')).toBeNull();
  });
});
```

```typescript
// src/features/auth/__tests__/LoginPage.test.tsx
import { describe, it, expect, vi } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { LoginPage } from '../LoginPage';
import { AuthProvider } from '../AuthContext';

vi.mock('@/app/axios');

describe('LoginPage', () => {
  it('should render login form', () => {
    render(
      <AuthProvider>
        <LoginPage />
      </AuthProvider>
    );

    expect(screen.getByText('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„')).toBeInTheDocument();
    expect(screen.getByPlaceholderText('example@email.com')).toBeInTheDocument();
  });

  it('should handle form submission', async () => {
    render(
      <AuthProvider>
        <LoginPage />
      </AuthProvider>
    );

    const emailInput = screen.getByPlaceholderText('example@email.com');
    const passwordInput = screen.getByPlaceholderText('â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢');
    const submitButton = screen.getByRole('button', { name: 'Ø¯Ø®ÙˆÙ„' });

    fireEvent.change(emailInput, { target: { value: 'test@test.com' } });
    fireEvent.change(passwordInput, { target: { value: 'password' } });
    fireEvent.click(submitButton);

    await waitFor(() => {
      expect(submitButton).toBeDisabled();
    });
  });
});
```

```bash
# Run tests
npm run test -- src/features/auth

# Expected: 5+ tests PASS âœ…
```

#### Integration Testing

```typescript
// src/test/integration/auth.test.tsx
import { describe, it, expect, vi } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { BrowserRouter } from 'react-router-dom';
import { AuthProvider } from '@/features/auth/AuthContext';
import { LoginPage } from '@/features/auth/LoginPage';
import axios from '@/app/axios';

vi.mock('@/app/axios');

describe('Authentication Integration', () => {
  it('should complete full login flow', async () => {
    const mockUser = {
      id: 1,
      name: 'Ø£Ø­Ù…Ø¯',
      email: 'ahmed@test.com',
      role: 'manager',
      permissions: [],
    };

    vi.mocked(axios.post).mockResolvedValue({
      data: { access_token: 'test-token', user: mockUser },
    });

    render(
      <BrowserRouter>
        <AuthProvider>
          <LoginPage />
        </AuthProvider>
      </BrowserRouter>
    );

    // Fill form
    fireEvent.change(screen.getByPlaceholderText('example@email.com'), {
      target: { value: 'ahmed@test.com' },
    });
    fireEvent.change(screen.getByPlaceholderText('â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢'), {
      target: { value: 'password123' },
    });

    // Submit
    fireEvent.click(screen.getByRole('button', { name: 'Ø¯Ø®ÙˆÙ„' }));

    // Verify API called
    await waitFor(() => {
      expect(axios.post).toHaveBeenCalledWith('/auth/login', {
        email: 'ahmed@test.com',
        password: 'password123',
      });
    });

    // Verify token saved
    expect(localStorage.getItem('access_token')).toBe('test-token');
  });
});
```

```bash
# Run integration tests
npm run test -- src/test/integration/auth

# Expected: PASS âœ…
```

#### User Testing

**Test Scenarios:**

1. **Happy Path - ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­**
   - Ø§ÙØªØ­ `/login`
   - Ø£Ø¯Ø®Ù„: `admin@inventory.com` / `password`
   - Ø§Ø¶ØºØ· "Ø¯Ø®ÙˆÙ„"
   - âœ… ÙŠØ¬Ø¨: Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù€ Dashboard

2. **Wrong Credentials - Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©**
   - Ø§ÙØªØ­ `/login`
   - Ø£Ø¯Ø®Ù„: `wrong@email.com` / `wrongpass`
   - Ø§Ø¶ØºØ· "Ø¯Ø®ÙˆÙ„"
   - âœ… ÙŠØ¬Ø¨: Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ "ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„"

3. **Protected Route - Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø§Øª**
   - Ø¨Ø¯ÙˆÙ† loginØŒ Ø§ÙØªØ­ `/dashboard`
   - âœ… ÙŠØ¬Ø¨: Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ù„Ù€ `/login`

4. **Logout - ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬**
   - Ø¨Ø¹Ø¯ LoginØŒ Ø§Ø¶ØºØ· "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"
   - âœ… ÙŠØ¬Ø¨: Ø­Ø°Ù Token + Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù€ Login

5. **Token Expiry - Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©**
   - Ø§Ø­Ø°Ù Token Ù…Ù† LocalStorage
   - Ø­Ø§ÙˆÙ„ ÙØªØ­ `/dashboard`
   - âœ… ÙŠØ¬Ø¨: Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ù„Ù€ `/login`

#### Code Review Checklist
- [ ] AuthContext ÙŠØ´ØªØºÙ„ ØµØ­
- [ ] Login page Ø¨ØªØµÙ…ÙŠÙ… Ø­Ù„Ùˆ
- [ ] Protected routes ØªØ´ØªØºÙ„
- [ ] Token management ØµØ­ÙŠØ­
- [ ] Error handling Ù…ÙˆØ¬ÙˆØ¯
- [ ] Tests ØªØ¹Ø¯ÙŠ
- [ ] No security issues

#### Exit Criteria
- âœ… 5+ unit tests passing
- âœ… Integration test passing
- âœ… All 5 user scenarios ØªØ¹Ù…Ù„
- âœ… No console errors
- âœ… Code reviewed & approved

#### Output
- âœ… Authentication system ÙƒØ§Ù…Ù„
- âœ… Login page Ø¬Ø§Ù‡Ø²
- âœ… Protected routes Ø¬Ø§Ù‡Ø²Ø©
- âœ… JWT integration ÙŠØ´ØªØºÙ„

---

### âœ… TASK-104: Layout & Navigation System
**Ø§Ù„Ù…Ø¯Ø©:** 2 Ø£ÙŠØ§Ù… (12 Ø³Ø§Ø¹Ø©)  
**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** ğŸ”´ CRITICAL  
**Dependencies:** TASK-103  
**Ø§Ù„Ø­Ø§Ù„Ø©:** â³ Pending

#### Ø§Ù„Ù‡Ø¯Ù
Ø¨Ù†Ø§Ø¡ Layout Ø£Ø³Ø§Ø³ÙŠ Ù…Ø¹ Sidebar + Navbar + Role-based navigation

#### Development

**1. App Layout:**
```typescript
// src/components/layout/AppLayout.tsx
import { ReactNode } from 'react';
import { Sidebar } from './Sidebar';
import { Navbar } from './Navbar';
import { useAuth } from '@/features/auth/AuthContext';

interface AppLayoutProps {
  children: ReactNode;
}

export function AppLayout({ children }: AppLayoutProps) {
  const { user } = useAuth();

  return (
    <div className="min-h-screen bg-gray-50 flex">
      {/* Sidebar */}
      <Sidebar />

      {/* Main Content */}
      <div className="flex-1 flex flex-col">
        {/* Navbar */}
        <Navbar />

        {/* Page Content */}
        <main className="flex-1 p-6 overflow-auto">
          {children}
        </main>
      </div>
    </div>
  );
}
```

**2. Sidebar Component:**
```typescript
// src/components/layout/Sidebar.tsx
import { Link, useLocation } from '@tanstack/react-router';
import { useAuth } from '@/features/auth/AuthContext';
import { 
  LayoutDashboard, 
  Package, 
  FileText, 
  Users, 
  DollarSign,
  BarChart3,
  Settings,
  LogOut
} from 'lucide-react';
import { cn } from '@/lib/utils';

interface NavItem {
  label: string;
  href: string;
  icon: any;
  permission?: string;
  roles?: string[];
}

export function Sidebar() {
  const { user, logout } = useAuth();
  const location = useLocation();

  const navItems: NavItem[] = [
    {
      label: 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
      href: '/dashboard',
      icon: LayoutDashboard,
    },
    {
      label: 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',
      href: '/products',
      icon: Package,
      permission: 'product.view',
    },
    {
      label: 'Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„ØµØ±Ù',
      href: '/issue-vouchers',
      icon: FileText,
      permission: 'voucher.issue.view',
    },
    {
      label: 'Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹',
      href: '/return-vouchers',
      icon: FileText,
      permission: 'voucher.return.view',
    },
    {
      label: 'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',
      href: '/customers',
      icon: Users,
      permission: 'customer.view',
    },
    {
      label: 'Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª',
      href: '/payments',
      icon: DollarSign,
      permission: 'payment.view',
    },
    {
      label: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',
      href: '/reports',
      icon: BarChart3,
      permission: 'report.view',
    },
    {
      label: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
      href: '/settings',
      icon: Settings,
      roles: ['manager'],
    },
  ];

  const canAccessItem = (item: NavItem) => {
    if (item.roles && !item.roles.includes(user?.role || '')) return false;
    if (item.permission && !user?.permissions.includes(item.permission)) return false;
    return true;
  };

  return (
    <aside className="w-64 bg-white border-l border-gray-200 flex flex-col">
      {/* Logo */}
      <div className="p-6 border-b border-gray-200">
        <h1 className="text-xl font-bold text-gray-900">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h1>
        <p className="text-sm text-gray-500">{user?.branch?.name}</p>
      </div>

      {/* Navigation */}
      <nav className="flex-1 p-4 space-y-1">
        {navItems.filter(canAccessItem).map((item) => {
          const Icon = item.icon;
          const isActive = location.pathname === item.href;

          return (
            <Link
              key={item.href}
              to={item.href}
              className={cn(
                'flex items-center gap-3 px-4 py-3 rounded-lg transition-colors',
                isActive
                  ? 'bg-blue-50 text-blue-600'
                  : 'text-gray-700 hover:bg-gray-50'
              )}
            >
              <Icon className="w-5 h-5" />
              <span>{item.label}</span>
            </Link>
          );
        })}
      </nav>

      {/* User Info & Logout */}
      <div className="p-4 border-t border-gray-200">
        <div className="flex items-center gap-3 mb-2">
          <div className="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
            <span className="text-blue-600 font-semibold">
              {user?.name.charAt(0)}
            </span>
          </div>
          <div className="flex-1">
            <p className="text-sm font-medium">{user?.name}</p>
            <p className="text-xs text-gray-500">{user?.role}</p>
          </div>
        </div>
        <button
          onClick={logout}
          className="w-full flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
        >
          <LogOut className="w-4 h-4" />
          <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
        </button>
      </div>
    </aside>
  );
}
```

**3. Navbar Component:**
```typescript
// src/components/layout/Navbar.tsx
import { Bell, Search } from 'lucide-react';
import { Input } from '@/components/ui/Input';
import { Button } from '@/components/ui/Button';

export function Navbar() {
  return (
    <header className="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-6">
      {/* Search */}
      <div className="flex-1 max-w-md">
        <div className="relative">
          <Search className="absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />
          <Input
            placeholder="Ø¨Ø­Ø«... (Ctrl+K)"
            className="pr-10"
          />
        </div>
      </div>

      {/* Actions */}
      <div className="flex items-center gap-4">
        {/* Notifications */}
        <button className="relative p-2 text-gray-600 hover:bg-gray-100 rounded-lg">
          <Bell className="w-5 h-5" />
          <span className="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full" />
        </button>

        {/* Quick Actions */}
        <Button variant="primary" size="sm">
          + Ø¥Ø°Ù† Ø¬Ø¯ÙŠØ¯
        </Button>
      </div>
    </header>
  );
}
```

#### Unit Testing

```typescript
// src/components/layout/__tests__/Sidebar.test.tsx
import { describe, it, expect, vi } from 'vitest';
import { render, screen } from '@testing-library/react';
import { Sidebar } from '../Sidebar';
import { AuthProvider } from '@/features/auth/AuthContext';

vi.mock('@tanstack/react-router', () => ({
  Link: ({ children, to }: any) => <a href={to}>{children}</a>,
  useLocation: () => ({ pathname: '/dashboard' }),
}));

const mockUser = {
  id: 1,
  name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
  role: 'manager',
  permissions: ['product.view', 'voucher.issue.view'],
  branch: { id: 1, name: 'ÙØ±Ø¹ Ø§Ù„Ø¹ØªØ¨Ø©' },
};

describe('Sidebar Component', () => {
  it('should render navigation items', () => {
    render(
      <AuthProvider>
        <Sidebar />
      </AuthProvider>
    );

    expect(screen.getByText('Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©')).toBeInTheDocument();
    expect(screen.getByText('Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª')).toBeInTheDocument();
  });

  it('should highlight active route', () => {
    render(
      <AuthProvider>
        <Sidebar />
      </AuthProvider>
    );

    const dashboardLink = screen.getByText('Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©').closest('a');
    expect(dashboardLink).toHaveClass('bg-blue-50');
  });

  it('should show user info', () => {
    render(
      <AuthProvider>
        <Sidebar />
      </AuthProvider>
    );

    expect(screen.getByText('Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯')).toBeInTheDocument();
  });
});
```

```bash
# Run tests
npm run test -- src/components/layout

# Expected: 5+ tests PASS âœ…
```

#### Integration Testing

```typescript
// src/test/integration/layout.test.tsx
import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';
import { BrowserRouter } from 'react-router-dom';
import { AuthProvider } from '@/features/auth/AuthContext';
import { AppLayout } from '@/components/layout/AppLayout';

describe('Layout Integration', () => {
  it('should render complete layout', () => {
    render(
      <BrowserRouter>
        <AuthProvider>
          <AppLayout>
            <div>Test Content</div>
          </AppLayout>
        </AuthProvider>
      </BrowserRouter>
    );

    // Sidebar exists
    expect(screen.getByText('Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†')).toBeInTheDocument();
    
    // Navbar exists
    expect(screen.getByPlaceholderText(/Ø¨Ø­Ø«/)).toBeInTheDocument();
    
    // Content rendered
    expect(screen.getByText('Test Content')).toBeInTheDocument();
  });
});
```

#### User Testing

**Scenarios:**
1. âœ… Sidebar ÙŠØ¸Ù‡Ø± Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ù€ links
2. âœ… Active route Ù…Ù…ÙŠØ² Ø¨Ù„ÙˆÙ† Ù…Ø®ØªÙ„Ù
3. âœ… User info ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„
4. âœ… Logout button ÙŠØ´ØªØºÙ„
5. âœ… Role-based items (manager ÙŠØ´ÙˆÙ SettingsØŒ ØºÙŠØ±Ù‡ Ù„Ø§)
6. âœ… Responsive (ÙŠØ®ÙÙŠ Sidebar Ø¹Ù„Ù‰ Mobile)

#### Exit Criteria
- âœ… Layout ÙƒØ§Ù…Ù„ ÙŠØ´ØªØºÙ„
- âœ… Sidebar navigation ØµØ­ÙŠØ­Ø©
- âœ… Role-based filtering ÙŠØ´ØªØºÙ„
- âœ… Tests ØªØ¹Ø¯ÙŠ
- âœ… UI responsive

#### Output
- âœ… AppLayout component
- âœ… Sidebar component
- âœ… Navbar component
- âœ… Ready Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª

---

### âœ… TASK-105: Dashboard Pages (3 Versions)
**Ø§Ù„Ù…Ø¯Ø©:** 3 Ø£ÙŠØ§Ù… (18 Ø³Ø§Ø¹Ø©)  
**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** ğŸŸ  HIGH  
**Dependencies:** TASK-104  
**Ø§Ù„Ø­Ø§Ù„Ø©:** â³ Pending

#### Ø§Ù„Ù‡Ø¯Ù
Ø¨Ù†Ø§Ø¡ 3 Dashboards Ù…Ø®ØµØµØ© Ù„ÙƒÙ„ Ø¯ÙˆØ± (Manager, Accountant, Store Manager)

#### Development

**1. Base Dashboard Component:**
```typescript
// src/features/dashboard/DashboardPage.tsx
import { useAuth } from '@/features/auth/AuthContext';
import { ManagerDashboard } from './ManagerDashboard';
import { AccountantDashboard } from './AccountantDashboard';
import { StoreManagerDashboard } from './StoreManagerDashboard';

export function DashboardPage() {
  const { user } = useAuth();

  switch (user?.role) {
    case 'manager':
      return <ManagerDashboard />;
    case 'accountant':
      return <AccountantDashboard />;
    case 'store_user':
      return <StoreManagerDashboard />;
    default:
      return <div>ØºÙŠØ± Ù…ØµØ±Ø­</div>;
  }
}
```

**2. Manager Dashboard:**
```typescript
// src/features/dashboard/ManagerDashboard.tsx
import { useQuery } from '@tanstack/react-query';
import { Card } from '@/components/ui/Card';
import { StatCard } from '@/components/shared/StatCard';
import { Package, FileText, Users, DollarSign } from 'lucide-react';
import axios from '@/app/axios';

export function ManagerDashboard() {
  const { data: stats } = useQuery({
    queryKey: ['dashboard-stats'],
    queryFn: async () => {
      const { data } = await axios.get('/dashboard/stats');
      return data;
    },
  });

  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…</h1>

      {/* KPI Cards */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <StatCard
          title="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª"
          value={stats?.total_products || 0}
          icon={Package}
          color="blue"
        />
        <StatCard
          title="Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„ÙŠÙˆÙ…"
          value={stats?.today_vouchers || 0}
          icon={FileText}
          color="green"
        />
        <StatCard
          title="Ø¹Ù…Ù„Ø§Ø¡ Ù†Ø´Ø·ÙŠÙ†"
          value={stats?.active_customers || 0}
          icon={Users}
          color="purple"
        />
        <StatCard
          title="Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†"
          value={`${stats?.inventory_value || 0} Ø¬`}
          icon={DollarSign}
          color="yellow"
        />
      </div>

      {/* Charts & Tables */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Branch Comparison */}
        <Card className="p-6">
          <h3 className="font-semibold mb-4">Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙØ±ÙˆØ¹</h3>
          {/* Chart here */}
        </Card>

        {/* Low Stock */}
        <Card className="p-6">
          <h3 className="font-semibold mb-4">Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶</h3>
          {/* Table here */}
        </Card>
      </div>
    </div>
  );
}
```

**3. Accountant Dashboard:**
```typescript
// src/features/dashboard/AccountantDashboard.tsx
import { useQuery } from '@tanstack/react-query';
import { Card } from '@/components/ui/Card';
import { StatCard } from '@/components/shared/StatCard';
import { AlertCircle, CheckCircle, Clock, DollarSign } from 'lucide-react';
import axios from '@/app/axios';
import { Button } from '@/components/ui/Button';

export function AccountantDashboard() {
  const { data: pendingVouchers } = useQuery({
    queryKey: ['pending-vouchers'],
    queryFn: async () => {
      const { data } = await axios.get('/vouchers/pending');
      return data;
    },
  });

  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ù…Ø­Ø§Ø³Ø¨</h1>

      {/* KPI Cards */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
        <StatCard
          title="Ù…Ø¹Ù„Ù‚"
          value={pendingVouchers?.length || 0}
          icon={Clock}
          color="yellow"
        />
        <StatCard
          title="Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…"
          value="45,000 Ø¬"
          icon={DollarSign}
          color="green"
        />
        <StatCard
          title="Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…"
          value="12,000 Ø¬"
          icon={CheckCircle}
          color="blue"
        />
        <StatCard
          title="Ø´ÙŠÙƒØ§Øª Ù…Ø¹Ù„Ù‚Ø©"
          value={8}
          icon={AlertCircle}
          color="red"
        />
      </div>

      {/* Pending Vouchers (Priority) */}
      <Card className="p-6">
        <div className="flex items-center justify-between mb-4">
          <h3 className="font-semibold">Ø£Ø°ÙˆÙ†Ø§Øª ØªÙ†ØªØ¸Ø± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</h3>
          <Button variant="ghost" size="sm">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</Button>
        </div>

        <div className="space-y-3">
          {pendingVouchers?.slice(0, 5).map((voucher: any) => (
            <div
              key={voucher.id}
              className="flex items-center justify-between p-4 bg-yellow-50 border border-yellow-200 rounded-lg"
            >
              <div>
                <p className="font-medium">Ø¥Ø°Ù† ØµØ±Ù #{voucher.id}</p>
                <p className="text-sm text-gray-600">
                  {voucher.customer_name} | {voucher.branch_name}
                </p>
              </div>
              <div className="flex items-center gap-2">
                <span className="font-semibold">{voucher.total} Ø¬</span>
                <Button variant="success" size="sm">Ø§Ø¹ØªÙ…Ø§Ø¯</Button>
                <Button variant="danger" size="sm">Ø±ÙØ¶</Button>
              </div>
            </div>
          ))}
        </div>
      </Card>
    </div>
  );
}
```

**4. Store Manager Dashboard:**
```typescript
// src/features/dashboard/StoreManagerDashboard.tsx
import { useQuery } from '@tanstack/react-query';
import { useAuth } from '@/features/auth/AuthContext';
import { Card } from '@/components/ui/Card';
import { StatCard } from '@/components/shared/StatCard';
import { Package, FileText, AlertTriangle, ArrowRightLeft } from 'lucide-react';
import axios from '@/app/axios';

export function StoreManagerDashboard() {
  const { user } = useAuth();
  const branchId = user?.branch_id;

  const { data: stats } = useQuery({
    queryKey: ['branch-stats', branchId],
    queryFn: async () => {
      const { data } = await axios.get(`/branches/${branchId}/stats`);
      return data;
    },
  });

  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold">
        Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - {user?.branch?.name}
      </h1>

      {/* KPI Cards */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
        <StatCard
          title="Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ÙØ±Ø¹"
          value={stats?.total_items || 0}
          icon={Package}
          color="blue"
        />
        <StatCard
          title="Ø£Ø°ÙˆÙ†Ø§ØªÙŠ Ø§Ù„ÙŠÙˆÙ…"
          value={stats?.today_vouchers || 0}
          icon={FileText}
          color="green"
        />
        <StatCard
          title="Ù…Ø¹Ù„Ù‚Ø© (Ø§Ø¹ØªÙ…Ø§Ø¯)"
          value={stats?.pending_vouchers || 0}
          icon={AlertTriangle}
          color="yellow"
        />
        <StatCard
          title="ØªØ­ÙˆÙŠÙ„Ø§Øª"
          value={stats?.transfers || 0}
          icon={ArrowRightLeft}
          color="purple"
        />
      </div>

      {/* Alerts */}
      <Card className="p-6">
        <h3 className="font-semibold mb-4 text-red-600">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
        <div className="space-y-2">
          <div className="flex items-center justify-between p-3 bg-red-50 rounded">
            <span>Ù„Ù…Ø¨Ø© LED 10W</span>
            <span className="text-red-600 font-semibold">15 ÙˆØ­Ø¯Ø© (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: 50)</span>
          </div>
        </div>
      </Card>

      {/* Quick Actions */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <Button className="h-20" variant="primary">
          + Ø¥Ø°Ù† ØµØ±Ù Ø¬Ø¯ÙŠØ¯
        </Button>
        <Button className="h-20" variant="secondary">
          + Ø¥Ø°Ù† Ø¥Ø±Ø¬Ø§Ø¹
        </Button>
        <Button className="h-20" variant="secondary">
          ğŸ”„ ØªØ­ÙˆÙŠÙ„ Ù„ÙØ±Ø¹ Ø¢Ø®Ø±
        </Button>
      </div>
    </div>
  );
}
```

**5. Shared Components:**
```typescript
// src/components/shared/StatCard.tsx
import { LucideIcon } from 'lucide-react';
import { Card } from '@/components/ui/Card';
import { cn } from '@/lib/utils';

interface StatCardProps {
  title: string;
  value: string | number;
  icon: LucideIcon;
  color: 'blue' | 'green' | 'yellow' | 'red' | 'purple';
}

export function StatCard({ title, value, icon: Icon, color }: StatCardProps) {
  const colors = {
    blue: 'bg-blue-100 text-blue-600',
    green: 'bg-green-100 text-green-600',
    yellow: 'bg-yellow-100 text-yellow-600',
    red: 'bg-red-100 text-red-600',
    purple: 'bg-purple-100 text-purple-600',
  };

  return (
    <Card className="p-6">
      <div className="flex items-center justify-between">
        <div>
          <p className="text-sm text-gray-600 mb-1">{title}</p>
          <p className="text-2xl font-bold">{value}</p>
        </div>
        <div className={cn('p-3 rounded-lg', colors[color])}>
          <Icon className="w-6 h-6" />
        </div>
      </div>
    </Card>
  );
}
```

#### Unit Testing

```typescript
// src/features/dashboard/__tests__/DashboardPage.test.tsx
import { describe, it, expect, vi } from 'vitest';
import { render, screen } from '@testing-library/react';
import { QueryClientProvider } from '@tanstack/react-query';
import { queryClient } from '@/app/queryClient';
import { AuthProvider } from '@/features/auth/AuthContext';
import { DashboardPage } from '../DashboardPage';

vi.mock('@/features/auth/AuthContext', () => ({
  useAuth: () => ({
    user: { role: 'manager', name: 'Ø£Ø­Ù…Ø¯' },
  }),
  AuthProvider: ({ children }: any) => children,
}));

describe('DashboardPage', () => {
  it('should render manager dashboard for manager role', () => {
    render(
      <QueryClientProvider client={queryClient}>
        <DashboardPage />
      </QueryClientProvider>
    );

    expect(screen.getByText('Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…')).toBeInTheDocument();
  });
});
```

```bash
# Run tests
npm run test -- src/features/dashboard

# Expected: 5+ tests PASS âœ…
```

#### Integration Testing

**Test: Dashboard loads data correctly**
```typescript
// src/test/integration/dashboard.test.tsx
import { describe, it, expect, vi } from 'vitest';
import { render, screen, waitFor } from '@testing-library/react';
import { QueryClientProvider } from '@tanstack/react-query';
import { queryClient } from '@/app/queryClient';
import { ManagerDashboard } from '@/features/dashboard/ManagerDashboard';
import axios from '@/app/axios';

vi.mock('@/app/axios');

describe('Dashboard Integration', () => {
  it('should load and display dashboard stats', async () => {
    vi.mocked(axios.get).mockResolvedValue({
      data: {
        total_products: 523,
        today_vouchers: 18,
        active_customers: 342,
        inventory_value: 2500000,
      },
    });

    render(
      <QueryClientProvider client={queryClient}>
        <ManagerDashboard />
      </QueryClientProvider>
    );

    await waitFor(() => {
      expect(screen.getByText('523')).toBeInTheDocument();
      expect(screen.getByText('18')).toBeInTheDocument();
    });
  });
});
```

#### User Testing

**Scenarios per Role:**

**Manager:**
1. âœ… ÙŠØ´ÙˆÙ 4 KPI cards
2. âœ… Charts ØªØ¸Ù‡Ø± ØµØ­
3. âœ… Low stock alert ÙŠØ´ØªØºÙ„
4. âœ… ÙƒÙ„ Ø§Ù„ÙØ±ÙˆØ¹ visible

**Accountant:**
1. âœ… Pending vouchers ØªØ¸Ù‡Ø±
2. âœ… Quick approve/reject buttons ØªØ´ØªØºÙ„
3. âœ… Today's stats ØµØ­ÙŠØ­Ø©
4. âœ… Cheque alerts ØªØ¸Ù‡Ø±

**Store Manager:**
1. âœ… Branch-specific stats
2. âœ… Low stock alerts Ù„ÙØ±Ø¹Ù‡ ÙÙ‚Ø·
3. âœ… Quick action buttons ØªØ´ØªØºÙ„
4. âœ… Pending vouchers (Ù…Ù†Ù‡) ØªØ¸Ù‡Ø±

#### Exit Criteria
- âœ… 3 Dashboards Ø¬Ø§Ù‡Ø²Ø©
- âœ… Role-based rendering ÙŠØ´ØªØºÙ„
- âœ… Data fetching ØµØ­ÙŠØ­
- âœ… All tests passing
- âœ… UI responsive

#### Output
- âœ… 3 Dashboard variants
- âœ… Role-based logic
- âœ… Real-time data
- âœ… User-tested âœ…

---

## ğŸ“Š Phase 1 Summary & Handoff

### âœ… Completed Tasks (Phase 1)

| Task ID | Name | Status | Duration | Tests |
|---------|------|--------|----------|-------|
| TASK-000 | Backend Verification | âœ… | 2h | 107/107 |
| TASK-101 | Project Setup | âœ… | 6h | 2/2 |
| TASK-102 | Design System | âœ… | 12h | 10+ |
| TASK-103 | Authentication | âœ… | 12h | 5+ |
| TASK-104 | Layout & Navigation | âœ… | 12h | 5+ |
| TASK-105 | Dashboards (3) | âœ… | 18h | 5+ |

**Total:** 62 hours (~8 days)  
**Total Tests:** 130+

---

### ğŸ“¦ Deliverables (Phase 1)

```
âœ… Frontend Project Setup
   - React 18 + TypeScript + Vite
   - Tailwind RTL configured
   - Axios + React Query
   - Folder structure

âœ… Design System (15+ components)
   - Button, Input, Select, Dialog, Toast
   - DataTable, Card, Badge, Spinner
   - FormField, DatePicker, SearchInput
   - All tested + documented

âœ… Authentication System
   - Login page
   - JWT integration
   - Auth context
   - Protected routes
   - Token management

âœ… Layout System
   - AppLayout (Sidebar + Navbar)
   - Role-based navigation
   - User menu
   - Responsive

âœ… Dashboards (3 versions)
   - Manager Dashboard
   - Accountant Dashboard
   - Store Manager Dashboard
   - KPI cards, charts, quick actions
```

---

### ğŸ¯ Next Steps (Phase 2)

Phase 2 Ø³ÙŠØºØ·ÙŠ:
- **TASK-201-210:** Products Management (5 pages)
- **TASK-301-310:** Issue Vouchers (5 pages)
- **TASK-401-410:** Return Vouchers (5 pages)
- **TASK-501-510:** Customers & Ledger (7 pages)
- **TASK-601-610:** Payments & Cheques (6 pages)

**Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:** 4 Ø£Ø³Ø§Ø¨ÙŠØ¹ (160 Ø³Ø§Ø¹Ø©)

---

### ğŸ“ Handoff Checklist

Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡ ÙÙŠ Phase 2ØŒ ØªØ£ÙƒØ¯ Ù…Ù†:

- [ ] âœ… ÙƒÙ„ tests Phase 1 passing (130+ tests)
- [ ] âœ… Backend verification Ù…ÙƒØªÙ…Ù„ (107 tests)
- [ ] âœ… Dev server ÙŠØ´ØªØºÙ„ Ø¨Ø¯ÙˆÙ† errors
- [ ] âœ… Authentication flow ÙŠØ´ØªØºÙ„
- [ ] âœ… 3 Dashboards ØªØ¸Ù‡Ø± ØµØ­ Ù„ÙƒÙ„ role
- [ ] âœ… Layout responsive Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø´Ø§Ø´Ø§Øª
- [ ] âœ… Code reviewed & approved
- [ ] âœ… Documentation updated
- [ ] âœ… Git committed & pushed

---

## ğŸš€ Ø§Ø³ØªØ¹Ø¯ Ù„Ù€ Phase 2!

**Phase 2 Ø³ÙŠÙƒÙˆÙ† Ø¶Ø®Ù…!** (~30 pages + 100+ tests)

Ù‡Ù„ Ø£Ù†Øª Ø¬Ø§Ù‡Ø²ØŸ ğŸ’ª

---

**ğŸ“„ End of Part 1**

**Next:** `PROJECT-TASKS-PART2.md` (Products, Vouchers, Customers, Payments)

**Status:** âœ… Foundation Complete - Ready for Core Features!
